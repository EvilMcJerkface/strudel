#!/bin/bash
# This script must be placed at "bin"
# directory of the following structure:
# [root_dir]
#   bin/ (placed here with other scripts)
#   lib/ (jar files used for workload engine)
#   (classpaths for workload)*
#
SOURCE="${BASH_SOURCE[0]}"
while [ -h "$SOURCE" ]; do 
  DIR="$( cd -P "$( dirname "$SOURCE" )" && pwd )"
  SOURCE="$(readlink "$SOURCE")"
  [[ $SOURCE != /* ]] && SOURCE="$DIR/$SOURCE"
done
root_dir="$( cd -P "$( dirname "$SOURCE" )/.." && pwd )"

CPATH="$root_dir/lib/*"
# if [ -e "$root_dir/target" ]; then # development environment
#  THIS_JAR=`echo $root_dir/target/strudel-workload-*.jar`
#  CPATH="$CPATH:$THIS_JAR:$root_dir/target/dependencies/*"
# fi

if [ -z "$STRUDEL_WKLD_OPTS" ]; then
	STRUDEL_WKLD_OPTS="-server -Xmx1G"
fi
for job in $@; do
	echo "running job: $job..."
	java "-Dstrudel.classpath.base=$root_dir" $STRUDEL_WKLD_OPTS -cp "$CPATH:$CLASSPATH" com.nec.strudel.workload.jobexec.JobRunner "$job"
	echo "job done: $job"
done
